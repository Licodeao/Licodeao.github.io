import { _ as _export_sfc, o as openBlock, c as createElementBlock, f as createStaticVNode } from "./app-5wU-U7Lk.js";
const _sfc_main = {};
const _hoisted_1 = /* @__PURE__ */ createStaticVNode('<p>昨天在实现WiFi打卡时，因为是第一次实现这种需求，故在此记录一下。</p><h2 id="起因" tabindex="-1"><a class="header-anchor" href="#起因" aria-hidden="true">#</a> 起因</h2><p>昨天在判断用户是否是使用指定WiFi时，发现了一个bug。</p><p>我们都知道，打开/关闭WiFi有两个途径：</p><ol><li>系统设置里的WiFi开关</li><li>手机界面右上角的状态栏中的WiFi开关</li></ol><p>那么此时问题就来了，如果查询微信小程序文档时，会找到通过wx.getSystemInfo()来获取WiFi开关的状态</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 回调函数返回的属性中有个wifiEnabled，它表明WiFi开关的状态</span>\nwx<span class="token punctuation">.</span><span class="token function">getSystemInfo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n  <span class="token function">success</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>wifiEnabled<span class="token punctuation">)</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>wifiEnabled<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token comment">// wx.startwifi() 初始化WiFi模块</span>\n      <span class="token comment">// wx.connectWifi() 连接WiFi</span>\n      <span class="token comment">// wx.onWifiConnected() 监听WiFi连接</span>\n      <span class="token comment">// 成功则发送签到打卡请求</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果是以上方案，那么就会<strong>漏掉</strong>一个重要的因素：手机界面右上角的状态栏中的WiFi开关，<strong>因为wifiEnabled仅仅表明系统设置里面的WiFi开关状态</strong></p><blockquote><p>模拟一个情况</p></blockquote><p>​ 先连上指定的WiFi，调用wx.getSystemInfo()，获取到了wifiEnabled且值为true，wx.onWifiConnected()回调成功的函数并发送签到打卡请求...</p><p>​ 但此时，如果<strong>将手机界面右上角的状态栏中的WiFi开关关闭</strong>（此时手机设置里的WiFi开关依然是开启状态，但手机右上角的状态栏中的WiFi开关是关闭状态），此时<strong>依然会触发wx.onWifiConnected()并执行成功的回调</strong>，进而发送签到打卡请求</p><h2 id="解决" tabindex="-1"><a class="header-anchor" href="#解决" aria-hidden="true">#</a> 解决</h2><p>​ 虽然关闭了右上角的状态栏中的WiFi开关仍会触发签到打卡请求，但<strong>此时手机使用的是流量，而非WiFi</strong></p><p>​ 抓住这一点，就可以成功实现WiFi签到打卡的需求</p><blockquote><p>大概流程</p></blockquote><ol><li>首先判断用户<strong>手机设置中是否开启WiFi</strong>，如果没有则不进行接下来的操作</li><li>如果手机设置中开启了WiFi，那么接下来<strong>获取手机的网络类型</strong><ul><li>如果<strong>网络类型不是WiFi</strong>，则提示用户连接指定WiFi后再签到，<strong>不进行接下来的操作</strong></li><li>如果<strong>网络类型是WiFi</strong>，需要<strong>判断用户连接的WiFi是否是指定的WiFi</strong><ul><li>如果<strong>是指定的WiFi</strong>，则<strong>发送签到打卡请求</strong></li></ul></li></ul></li></ol><blockquote><p>流程代码</p></blockquote><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token function">onDuty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n	<span class="token keyword">let</span> that <span class="token operator">=</span> <span class="token keyword">this</span>\n	<span class="token comment">// 判断手机设置有没有打开WiFi开关</span>\n	wx<span class="token punctuation">.</span><span class="token function">getSystemInfo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n		<span class="token function">success</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n			that<span class="token punctuation">.</span>isOpenMobileWifi <span class="token operator">=</span> res<span class="token punctuation">.</span>wifiEnabled\n			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>that<span class="token punctuation">.</span>isOpenMobileWifi<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n				uni<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n					<span class="token literal-property property">icon</span><span class="token operator">:</span> <span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span>\n					<span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&quot;请打开WiFi开关&quot;</span><span class="token punctuation">,</span>\n					<span class="token literal-property property">duration</span><span class="token operator">:</span> <span class="token number">2000</span>\n				<span class="token punctuation">}</span><span class="token punctuation">)</span>\n		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n			<span class="token keyword">let</span> <span class="token constant">SSID</span> <span class="token operator">=</span> <span class="token string">&quot;指定的WiFi的名称&quot;</span>\n			<span class="token keyword">let</span> <span class="token constant">BSSID</span> <span class="token operator">=</span> <span class="token string">&quot;指定的WiFi的MAC地址&quot;</span>\n      <span class="token comment">// 获取网络类型</span>\n      wx<span class="token punctuation">.</span><span class="token function">getNetworkType</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n        <span class="token function">success</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>networkType <span class="token operator">!==</span> <span class="token string">&quot;wifi&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            uni<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n              <span class="token literal-property property">icon</span><span class="token operator">:</span> <span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span>\n              <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&quot;请连接工作室WiFi&quot;</span><span class="token punctuation">,</span>\n              <span class="token literal-property property">duration</span><span class="token operator">:</span> <span class="token number">2000</span>\n            <span class="token punctuation">}</span><span class="token punctuation">)</span>\n          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n            <span class="token comment">// 判断是不是工作室的WiFi</span>\n            wx<span class="token punctuation">.</span><span class="token function">getConnectedWifi</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n              <span class="token function">success</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n                <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>wifi<span class="token punctuation">.</span><span class="token constant">SSID</span> <span class="token operator">===</span> <span class="token constant">SSID</span> <span class="token operator">&amp;&amp;</span> res<span class="token punctuation">.</span>wifi<span class="token punctuation">.</span><span class="token constant">BSSID</span> <span class="token operator">===</span> <span class="token constant">BSSID</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n                  that<span class="token punctuation">.</span>isSuccess <span class="token operator">=</span> <span class="token boolean">true</span>\n                  uni<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n                    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">&#39;签到打卡请求&#39;</span><span class="token punctuation">,</span>\n                    <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">&#39;GET&#39;</span><span class="token punctuation">,</span>\n                    <span class="token literal-property property">header</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n                      <span class="token string-property property">&quot;Authorization&quot;</span><span class="token operator">:</span> uni<span class="token punctuation">.</span><span class="token function">getStorageSync</span><span class="token punctuation">(</span><span class="token string">&#39;tokenHead&#39;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&#39; &#39;</span> <span class="token operator">+</span> uni<span class="token punctuation">.</span><span class="token function">getStorageSync</span><span class="token punctuation">(</span><span class="token string">&#39;token&#39;</span><span class="token punctuation">)</span>\n                    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n                    <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n                      <span class="token literal-property property">place</span><span class="token operator">:</span> that<span class="token punctuation">.</span>isSuccess<span class="token punctuation">,</span>\n                      <span class="token literal-property property">success</span><span class="token operator">:</span> that<span class="token punctuation">.</span>isSuccess<span class="token punctuation">,</span>\n                      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token number">2</span>\n                    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n                    <span class="token function">success</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n                      <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>code <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n                        uni<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n                          <span class="token literal-property property">icon</span><span class="token operator">:</span> <span class="token string">&#39;success&#39;</span><span class="token punctuation">,</span>\n                          <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&quot;签到成功&quot;</span><span class="token punctuation">,</span>\n                          <span class="token literal-property property">duration</span><span class="token operator">:</span> <span class="token number">2000</span>\n                        <span class="token punctuation">}</span><span class="token punctuation">)</span>\n                      <span class="token punctuation">}</span>\n                      <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>code <span class="token operator">===</span> <span class="token number">401</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n                        uni<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n                          <span class="token literal-property property">icon</span><span class="token operator">:</span> <span class="token string">&#39;error&#39;</span><span class="token punctuation">,</span>\n                          <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&quot;请先登录&quot;</span><span class="token punctuation">,</span>\n                          <span class="token literal-property property">duration</span><span class="token operator">:</span> <span class="token number">2000</span>\n                        <span class="token punctuation">}</span><span class="token punctuation">)</span>\n                      <span class="token punctuation">}</span>\n                      <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>code <span class="token operator">===</span> <span class="token number">500</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n                        uni<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n                          <span class="token literal-property property">icon</span><span class="token operator">:</span> <span class="token string">&#39;error&#39;</span><span class="token punctuation">,</span>\n                          <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&quot;本周不是你值班&quot;</span><span class="token punctuation">,</span>\n                          <span class="token literal-property property">duration</span><span class="token operator">:</span> <span class="token number">2000</span>\n                        <span class="token punctuation">}</span><span class="token punctuation">)</span>\n                      <span class="token punctuation">}</span>\n                    <span class="token punctuation">}</span>\n                  <span class="token punctuation">}</span><span class="token punctuation">)</span>\n                <span class="token punctuation">}</span>\n              <span class="token punctuation">}</span>\n            <span class="token punctuation">}</span><span class="token punctuation">)</span>\n          <span class="token punctuation">}</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="总结" tabindex="-1"><a class="header-anchor" href="#总结" aria-hidden="true">#</a> 总结</h2><p>使用网络进行打卡签到时，尤其注意<strong>手机设置</strong>与<strong>手机右上角状态栏</strong>的区别，流程倒不难理解，在此mark一下。</p>', 20);
const _hoisted_21 = [
  _hoisted_1
];
function _sfc_render(_ctx, _cache) {
  return openBlock(), createElementBlock("div", null, _hoisted_21);
}
const Wifi_clock_in_WeChat_mini_program_html = /* @__PURE__ */ _export_sfc(_sfc_main, [["render", _sfc_render], ["__file", "Wifi clock in WeChat mini program.html.vue"]]);
export {
  Wifi_clock_in_WeChat_mini_program_html as default
};
